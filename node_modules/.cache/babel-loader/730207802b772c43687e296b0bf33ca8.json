{"ast":null,"code":"import { useState, useContext } from 'react';\nimport { LoginContext } from '../Auth/context';\n\nconst useAjax = props => {\n  const todoAPI = \"https://api-js401.herokuapp.com/api/v1/todo\";\n  const [list, setList] = useState([]);\n  const loginContext = useContext(LoginContext);\n\n  const _addItem = item => {\n    if (loginContext.user.user.type === 'admin' || loginContext.user.user.type === 'editor') {\n      item.due = new Date();\n      fetch(todoAPI, {\n        method: \"post\",\n        mode: \"cors\",\n        cache: \"no-cache\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(item)\n      }).then(response => response.json()).then(savedItem => {\n        setList([...list, savedItem]);\n      }).catch(console.error);\n    }\n  };\n\n  const _toggleComplete = id => {\n    let item = list.filter(i => i._id === id)[0] || {};\n\n    if (item._id) {\n      item.complete = !item.complete;\n      let url = `${todoAPI}/${id}`;\n      fetch(url, {\n        method: \"put\",\n        mode: \"cors\",\n        cache: \"no-cache\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(item)\n      }).then(response => response.json()).then(savedItem => {\n        setList(list.map(listItem => listItem._id === item._id ? savedItem : listItem));\n      }).catch(console.error);\n    }\n  };\n\n  const _getTodoItems = () => {\n    fetch(todoAPI, {\n      method: \"get\",\n      mode: \"cors\"\n    }).then(data => data.json()).then(data => setList(data.results)).catch(console.error);\n  };\n\n  const _deleteTask = id => {\n    let item = list.filter(i => i._id === id)[0] || {};\n\n    if (item._id) {\n      let url = `${todoAPI}/${id}`;\n      fetch(url, {\n        method: 'delete',\n        mode: 'cors'\n      }).then(data => data.json()).then(data => {\n        console.log(data);\n        const newList = list.filter(item => item !== data);\n        setList(newList);\n\n        _getTodoItems();\n      }).catch(console.error);\n    }\n  };\n\n  return [list, _addItem, _toggleComplete, _getTodoItems, _deleteTask];\n};\n\nexport default useAjax;","map":{"version":3,"sources":["/home/boshra/401labs/hooks/todo/src/customHooks/Ajax.js"],"names":["useState","useContext","LoginContext","useAjax","props","todoAPI","list","setList","loginContext","_addItem","item","user","type","due","Date","fetch","method","mode","cache","headers","body","JSON","stringify","then","response","json","savedItem","catch","console","error","_toggleComplete","id","filter","i","_id","complete","url","map","listItem","_getTodoItems","data","results","_deleteTask","log","newList"],"mappings":"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","sourcesContent":["import { useState,useContext  } from 'react';\nimport { LoginContext } from '../Auth/context';\n\nconst useAjax = (props) => {\n    const todoAPI = \"https://api-js401.herokuapp.com/api/v1/todo\";\n  const [list, setList] = useState([]);\n  const loginContext = useContext(LoginContext);\n\n\n  const _addItem = (item) => {\n    if(loginContext.user.user.type === 'admin' || loginContext.user.user.type === 'editor'){\n      item.due = new Date();\n      fetch(todoAPI, {\n        method: \"post\",\n        mode: \"cors\",\n        cache: \"no-cache\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(item),\n      })\n        .then((response) => response.json())\n        .then((savedItem) => {\n          setList([...list, savedItem]);\n        })\n        .catch(console.error);\n    }\n   \n  };\n  \n  const _toggleComplete = (id) => {\n    let item = list.filter((i) => i._id === id)[0] || {};\n\n    if (item._id) {\n      item.complete = !item.complete;\n\n      let url = `${todoAPI}/${id}`;\n\n      fetch(url, {\n        method: \"put\",\n        mode: \"cors\",\n        cache: \"no-cache\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(item),\n      })\n        .then((response) => response.json())\n        .then((savedItem) => {\n          setList(\n            list.map((listItem) =>\n              listItem._id === item._id ? savedItem : listItem\n            )\n          );\n        })\n        .catch(console.error);\n    }\n  };\n\n  const _getTodoItems = () => {\n    fetch(todoAPI, {\n      method: \"get\",\n      mode: \"cors\",\n    })\n      .then((data) => data.json())\n      .then((data) => setList(data.results))\n      .catch(console.error);\n  };\n\n  const _deleteTask =  (id)=>{\n    let item = list.filter((i) => i._id === id)[0] || {};\n    if (item._id) {\n      let url = `${todoAPI}/${id}`;\n      fetch(url, {\n        method: 'delete',\n        mode: 'cors',\n      }).then((data) => data.json())\n      .then((data) =>{\n        console.log(data);\n        const newList = list.filter(item => item !== data)\n\n        setList(newList)\n        _getTodoItems()\n      })\n      .catch(console.error);\n    }\n}\n\n  return [list, _addItem, _toggleComplete, _getTodoItems, _deleteTask ];\n};\n\nexport default useAjax;"]},"metadata":{},"sourceType":"module"}