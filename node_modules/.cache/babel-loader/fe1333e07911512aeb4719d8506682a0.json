{"ast":null,"code":"import _regeneratorRuntime from\"/home/boshra/401labs/hooks/todo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/boshra/401labs/hooks/todo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/boshra/401labs/hooks/todo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import cookie from\"react-cookies\";import jwt from\"jsonwebtoken\";import dotenv from\"dotenv\";import superagent from\"superagent\";dotenv.config();var API='https://auth-server-401.herokuapp.com';// const SECERT = process.env.JWT_SECRET;\n// this component is responsible for the login and log out and setting the cookies and the global state.\nexport var LoginContext=React.createContext();var LoginProvider=function LoginProvider(props){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loggedIn=_useState4[0],setLoggedIn=_useState4[1];useEffect(function(){var token=cookie.load('auth');validateToken(token);},[]);function validateToken(token){try{var _user=jwt.decode(token);if(_user)setLoginState(true,token,_user);}catch(error){setLoginState(false,null,{});console.log(\"Token Validation Error \".concat(error.message));}}function setLoginState(loggedIn,token,user){cookie.save('auth',token);setUser({user:user});setLoggedIn(loggedIn);}function setLogoutState(loggedIn,user){cookie.save('auth',null);setUser({user:user});setLoggedIn(loggedIn);}function login(_x,_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(username,password){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return superagent.post(\"\".concat(API,\"/signin\")).set('authorization',\"Basic \".concat(btoa(\"\".concat(username,\":\").concat(password))));case 3:response=_context.sent;validateToken(response.body.token);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.error('Signin Error',_context.t0.message);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return _login.apply(this,arguments);}function signup(_x3,_x4,_x5,_x6){return _signup.apply(this,arguments);}function _signup(){_signup=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,username,password,role){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return superagent.post(\"\".concat(API,\"/signup\"),{email:email,username:username,password:password,role:role});case 3:response=_context2.sent;validateToken(response.body.token);_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.error('Signup Error',_context2.t0.message);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return _signup.apply(this,arguments);}function logout(){setLogoutState(false,{});}var state={user:user,setUser:setUser,loggedIn:loggedIn,setLoggedIn:setLoggedIn,login:login,signup:signup,logout:logout};return/*#__PURE__*/React.createElement(LoginContext.Provider,{value:state},props.children);};export default LoginProvider;","map":{"version":3,"sources":["/home/boshra/401labs/hooks/todo/src/Auth/context.js"],"names":["React","useState","useEffect","cookie","jwt","dotenv","superagent","config","API","LoginContext","createContext","LoginProvider","props","user","setUser","loggedIn","setLoggedIn","token","load","validateToken","decode","setLoginState","error","console","log","message","save","setLogoutState","login","username","password","post","set","btoa","response","body","signup","email","role","logout","state","children"],"mappings":"+bAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,MAAP,KAAmB,eAAnB,CACA,MAAOC,CAAAA,GAAP,KAAgB,cAAhB,CACA,MAAOC,CAAAA,MAAP,KAAmB,QAAnB,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACAD,MAAM,CAACE,MAAP,GAEA,GAAMC,CAAAA,GAAG,CAAG,uCAAZ,CACA;AACA;AACA,MAAO,IAAMC,CAAAA,YAAY,CAAGT,KAAK,CAACU,aAAN,EAArB,CAEP,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,KAAD,CAAW,CAEhC,cAAwBX,QAAQ,CAAC,EAAD,CAAhC,wCAAOY,IAAP,eAAaC,OAAb,eACA,eAAgCb,QAAQ,CAAC,KAAD,CAAxC,yCAAOc,QAAP,eAAiBC,WAAjB,eAEAd,SAAS,CAAC,UAAM,CACf,GAAMe,CAAAA,KAAK,CAAGd,MAAM,CAACe,IAAP,CAAY,MAAZ,CAAd,CACAC,aAAa,CAACF,KAAD,CAAb,CACA,CAHQ,CAGN,EAHM,CAAT,CAKA,QAASE,CAAAA,aAAT,CAAuBF,KAAvB,CAA8B,CAC7B,GAAI,CACH,GAAMJ,CAAAA,KAAI,CAAGT,GAAG,CAACgB,MAAJ,CAAWH,KAAX,CAAb,CACA,GAAIJ,KAAJ,CAAUQ,aAAa,CAAC,IAAD,CAAOJ,KAAP,CAAcJ,KAAd,CAAb,CACV,CAAC,MAAOS,KAAP,CAAc,CACfD,aAAa,CAAC,KAAD,CAAQ,IAAR,CAAc,EAAd,CAAb,CACAE,OAAO,CAACC,GAAR,kCAAsCF,KAAK,CAACG,OAA5C,GACA,CACD,CAED,QAASJ,CAAAA,aAAT,CAAuBN,QAAvB,CAAiCE,KAAjC,CAAwCJ,IAAxC,CAA8C,CAC7CV,MAAM,CAACuB,IAAP,CAAY,MAAZ,CAAoBT,KAApB,EACAH,OAAO,CAAC,CAAED,IAAI,CAAJA,IAAF,CAAD,CAAP,CACAG,WAAW,CAACD,QAAD,CAAX,CACA,CAED,QAASY,CAAAA,cAAT,CAAwBZ,QAAxB,CAAkCF,IAAlC,CAAwC,CACvCV,MAAM,CAACuB,IAAP,CAAY,MAAZ,CAAoB,IAApB,EACAZ,OAAO,CAAC,CAAED,IAAI,CAAJA,IAAF,CAAD,CAAP,CACAG,WAAW,CAACD,QAAD,CAAX,CACA,CA9B+B,QAgCjBa,CAAAA,KAhCiB,+HAgChC,iBAAqBC,QAArB,CAA+BC,QAA/B,qKAEyBxB,CAAAA,UAAU,CAC/ByB,IADqB,WACbvB,GADa,aAErBwB,GAFqB,CAEjB,eAFiB,iBAESC,IAAI,WAAIJ,QAAJ,aAAgBC,QAAhB,EAFb,EAFzB,QAEQI,QAFR,eAKEf,aAAa,CAACe,QAAQ,CAACC,IAAT,CAAclB,KAAf,CAAb,CALF,+EAOEM,OAAO,CAACD,KAAR,CAAc,cAAd,CAA8B,YAAMG,OAApC,EAPF,oEAhCgC,gDA2CjBW,CAAAA,MA3CiB,2IA2ChC,kBAAsBC,KAAtB,CAA6BR,QAA7B,CAAuCC,QAAvC,CAAiDQ,IAAjD,2KAEyBhC,CAAAA,UAAU,CAACyB,IAAX,WAAmBvB,GAAnB,YAAiC,CACvD6B,KAAK,CAALA,KADuD,CAEvDR,QAAQ,CAARA,QAFuD,CAGvDC,QAAQ,CAARA,QAHuD,CAIvDQ,IAAI,CAAJA,IAJuD,CAAjC,CAFzB,QAEQJ,QAFR,gBASEf,aAAa,CAACe,QAAQ,CAACC,IAAT,CAAclB,KAAf,CAAb,CATF,mFAWEM,OAAO,CAACD,KAAR,CAAc,cAAd,CAA8B,aAAMG,OAApC,EAXF,sEA3CgC,yCA0DhC,QAASc,CAAAA,MAAT,EAAkB,CACjBZ,cAAc,CAAC,KAAD,CAAQ,EAAR,CAAd,CACA,CAED,GAAMa,CAAAA,KAAK,CAAG,CACb3B,IAAI,CAAJA,IADa,CAEbC,OAAO,CAAPA,OAFa,CAGbC,QAAQ,CAARA,QAHa,CAIbC,WAAW,CAAXA,WAJa,CAKbY,KAAK,CAALA,KALa,CAMbQ,MAAM,CAANA,MANa,CAObG,MAAM,CAANA,MAPa,CAAd,CAWA,mBACC,oBAAC,YAAD,CAAc,QAAd,EAAuB,KAAK,CAAEC,KAA9B,EACE5B,KAAK,CAAC6B,QADR,CADD,CAKA,CA9ED,CAkFA,cAAe9B,CAAAA,aAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport cookie from \"react-cookies\";\nimport jwt from \"jsonwebtoken\";\nimport dotenv from \"dotenv\";\nimport superagent from \"superagent\";\ndotenv.config();\n\nconst API = 'https://auth-server-401.herokuapp.com';\n// const SECERT = process.env.JWT_SECRET;\n// this component is responsible for the login and log out and setting the cookies and the global state.\nexport const LoginContext = React.createContext();\n\nconst LoginProvider = (props) => {\n\n\tconst [user, setUser] = useState({});\n\tconst [loggedIn, setLoggedIn] = useState(false);\n\n\tuseEffect(() => {\n\t\tconst token = cookie.load('auth');\n\t\tvalidateToken(token);\n\t}, []);\n\n\tfunction validateToken(token) {\n\t\ttry {\n\t\t\tconst user = jwt.decode(token);\n\t\t\tif (user) setLoginState(true, token, user);\n\t\t} catch (error) {\n\t\t\tsetLoginState(false, null, {});\n\t\t\tconsole.log(`Token Validation Error ${error.message}`);\n\t\t}\n\t}\n\n\tfunction setLoginState(loggedIn, token, user) {\n\t\tcookie.save('auth', token);\n\t\tsetUser({ user });\n\t\tsetLoggedIn(loggedIn);\n\t}\n\n\tfunction setLogoutState(loggedIn, user) {\n\t\tcookie.save('auth', null);\n\t\tsetUser({ user });\n\t\tsetLoggedIn(loggedIn);\n\t}\n\n\tasync function login(username, password) {\n\t\ttry {\n\t\t\tconst response = await superagent\n\t\t\t\t.post(`${API}/signin`)\n\t\t\t\t.set('authorization', `Basic ${btoa(`${username}:${password}`)}`);\n\t\t\tvalidateToken(response.body.token);\n\t\t} catch (error) {\n\t\t\tconsole.error('Signin Error', error.message);\n\t\t}\n\t}\n\n\tasync function signup(email, username, password, role) {\n\t\ttry {\n\t\t\tconst response = await superagent.post(`${API}/signup`, {\n\t\t\t\temail,\n\t\t\t\tusername,\n\t\t\t\tpassword,\n\t\t\t\trole,\n\t\t\t});\n\n\t\t\tvalidateToken(response.body.token);\n\t\t} catch (error) {\n\t\t\tconsole.error('Signup Error', error.message);\n\t\t}\n\t}\n\n\tfunction logout() {\n\t\tsetLogoutState(false, {});\n\t}\n\n\tconst state = {\n\t\tuser,\n\t\tsetUser,\n\t\tloggedIn,\n\t\tsetLoggedIn,\n\t\tlogin,\n\t\tsignup,\n\t\tlogout,\n\t\t\n\t};\n\n\treturn (\n\t\t<LoginContext.Provider value={state}>\n\t\t\t{props.children}\n\t\t</LoginContext.Provider>\n\t);\n};\n\n\n\nexport default LoginProvider;\n"]},"metadata":{},"sourceType":"module"}